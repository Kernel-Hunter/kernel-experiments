#!/usr/bin/env python3
"""
Simple pentest helper that runs nmap and summarizes open ports.
Requires nmap installed on the host.
Usage:
  python3 tools/pentest_helper.py 127.0.0.1
"""

import subprocess
import sys
import json

def run_nmap(target):
    cmd = ["nmap", "-oX", "-", "-sV", target]  # XML to stdout
    out = subprocess.check_output(cmd)
    return out.decode()

def main():
    if len(sys.argv) < 2:
        print("Usage: pentest_helper.py <target>")
        sys.exit(2)
    target = sys.argv[1]
    try:
        xml = run_nmap(target)
        # naive parse: look for <port protocol="tcp" portid="22"> entries
        # For production use: use python-nmap or lxml to parse properly.
        ports = []
        for line in xml.splitlines():
            if 'portid="' in line and 'state=' in line:
                # quick extract
                try:
                    p = line.split('portid="')[1].split('"')[0]
                    ports.append(int(p))
                except Exception:
                    pass
        ports = sorted(set(ports))
        print(f"Target: {target}")
        print("Open ports (detected):", ports)
    except subprocess.CalledProcessError as e:
        print("nmap failed:", e)
        sys.exit(1)

if __name__ == "__main__":
    main()
